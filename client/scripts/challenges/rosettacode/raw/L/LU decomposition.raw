
/* eslint spaced-comment: 0 */
/* eslint no-redeclare: 0 */
/* eslint no-undef: 0 */
/* eslint no-unused-vars: 0 */

const assert = require('chai').assert;

/// title: LU decomposition
/// type: rosetta-code

/// categories:


/// difficulty: ?

/// benchmark:
replaceWithActualFunctionHere;

/// description:
/// <br>
/// Every square matrix $A$ can be decomposed into a product of a lower triangular matrix $L$ and a upper triangular matrix $U$, 
/// as described in <a class="rosetta__link--wiki" href="https://en.wikipedia.org/wiki/LU decomposition" title="wp: LU decomposition">LU decomposition</a>.
/// <br>
/// <span class="rosetta__text--indented">$A = LU$</span>
/// <br>
/// It is a modified form of Gaussian elimination. 
/// While the <a class="rosetta__link--rosetta" href="http://rosettacode.org/wiki/Cholesky decomposition" title="Cholesky decomposition">Cholesky decomposition</a> only works for symmetric, 
/// positive definite matrices, the more general LU decomposition 
/// works for any square matrix. 
/// <br>
/// There are several algorithms for calculating L and U. 
/// To derive <span class="rosetta__text--italic">Crout's algorithm</span> for a 3x3 example, 
/// we have to solve the following system:
/// <br>
/// <span class="rosetta__text--indented">$</span>
/// A =
/// \begin{pmatrix}
///    a_{11} & a_{12} & a_{13}\\
///    a_{21} & a_{22} & a_{23}\\
///    a_{31} & a_{32} & a_{33}\\
/// \end{pmatrix}
/// =
/// \begin{pmatrix}
///    l_{11} & 0 & 0 \\
///    l_{21} & l_{22} & 0 \\
///    l_{31} & l_{32} & l_{33}\\
/// \end{pmatrix}
/// \begin{pmatrix}
///    u_{11} & u_{12} & u_{13} \\
///    0 & u_{22} & u_{23} \\
///    0 & 0 & u_{33}
/// \end{pmatrix}
/// = LU
/// $
/// <br>
/// We now would have to solve 9 equations with 12 unknowns. To make the system uniquely solvable, usually the diagonal elements of $L$ are set to 1
/// <br>
/// <span class="rosetta__text--indented">$l_{11}=1$</span>
/// <span class="rosetta__text--indented">$l_{22}=1$</span>
/// <span class="rosetta__text--indented">$l_{33}=1$</span>
/// <br>
/// so we get a solvable system of 9 unknowns and 9 equations.
/// <br>
/// <span class="rosetta__text--indented">$</span>
/// A =
/// \begin{pmatrix}
///    a_{11} & a_{12} & a_{13}\\
///    a_{21} & a_{22} & a_{23}\\
///    a_{31} & a_{32} & a_{33}\\
/// \end{pmatrix}
/// =
/// \begin{pmatrix}
///    1      & 0      & 0 \\
///    l_{21} & 1      & 0 \\
///    l_{31} & l_{32} & 1\\
/// \end{pmatrix}
/// \begin{pmatrix}
///    u_{11} & u_{12} & u_{13} \\
///    0 & u_{22} & u_{23} \\
///    0 & 0 & u_{33}
/// \end{pmatrix}
/// =
/// \begin{pmatrix}
///    u_{11}        & u_{12}                    & u_{13}              \\
///    u_{11}l_{21}  & u_{12}l_{21}+u_{22}       & u_{13}l_{21}+u_{23} \\
///    u_{11}l_{31}  & u_{12}l_{31}+u_{22}l_{32} & u_{13}l_{31} + u_{23}l_{32}+u_{33}
/// \end{pmatrix}
/// = LU
/// $
/// <br>
/// Solving for the other $l$ and $u$, we get the following equations:
/// <br>
/// <span class="rosetta__text--indented">$u_{11}=a_{11}$</span>
/// <span class="rosetta__text--indented">$u_{12}=a_{12}$</span>
/// <span class="rosetta__text--indented">$u_{13}=a_{13}$</span>
/// <br>
/// <span class="rosetta__text--indented">$u_{22}=a_{22} - u_{12}l_{21}$</span>
/// <span class="rosetta__text--indented">$u_{23}=a_{23} - u_{13}l_{21}$</span>
/// <br>
/// <span class="rosetta__text--indented">$u_{33}=a_{33} - (u_{13}l_{31} + u_{23}l_{32})$</span>
/// <br>
/// and for $l$:
/// <br>
/// <span class="rosetta__text--indented">$l_{21}=\frac{1}{u_{11}} a_{21}$</span>
/// <span class="rosetta__text--indented">$l_{31}=\frac{1}{u_{11}} a_{31}$</span>
/// <br>
/// <span class="rosetta__text--indented">$l_{32}=\frac{1}{u_{22}} (a_{32} - u_{12}l_{31})$</span>
/// <br>
/// We see that there is a calculation pattern, which can be expressed as the following formulas, first for $U$
/// <br>
/// <span class="rosetta__text--indented">$u_{ij} = a_{ij} - \sum_{k=1}^{i-1} u_{kj}l_{ik}$</span>
/// <br>
/// and then for $L$
/// <br>
/// <span class="rosetta__text--indented">$l_{ij} = \frac{1}{u_{jj}} (a_{ij} - \sum_{k=1}^{j-1} u_{kj}l_{ik})$</span>
/// <br>
/// We see in the second formula that to get the $l_{ij}$ below the diagonal, we have to divide by the diagonal element (pivot) $u_{jj}$, so we get problems when $u_{jj}$ is either 0 or very small, which leads to numerical instability. 
/// <br>
/// The solution to this problem is <span class="rosetta__text--italic">pivoting</span> $A$, which means rearranging the rows of $A$, prior to the $LU$ decomposition, in a way that the largest element of each column gets onto the diagonal of $A$. Rearranging the rows means to multiply $A$ by a permutation matrix $P$:
/// <br>
/// <span class="rosetta__text--indented">$PA \Rightarrow A'$</span>
/// <br>
/// Example:
/// <br>
/// <span class="rosetta__text--indented">$</span>
/// \begin{pmatrix}
///    0 & 1 \\
///    1 & 0 
/// \end{pmatrix}
/// \begin{pmatrix}
///    1 & 4 \\
///    2 & 3 
/// \end{pmatrix}
/// \Rightarrow
/// \begin{pmatrix}
///    2 & 3 \\
///    1 & 4 
/// \end{pmatrix}
/// $
/// <br>
/// The decomposition algorithm is then applied on the rearranged matrix so that
/// <br>
/// <span class="rosetta__text--indented">$PA = LU$</span>
/// <br>
/// <br>
/// <span class="rosetta__text--bold">Task description</span>
/// <br>
/// The task is to implement a routine which will take a square nxn matrix $A$ and return a lower triangular matrix $L$, a upper triangular matrix $U$ and a permutation matrix $P$, 
/// so that the above equation is fullfilled. 
/// You should then test it on the following two examples and include your output.
/// <br>
/// Example 1:
/// <pre>
/// A
/// <br>
/// 1   3   5
/// 2   4   7
/// 1   1   0
/// <br>
/// L
/// <br>
/// 1.00000   0.00000   0.00000
/// 0.50000   1.00000   0.00000
/// 0.50000  -1.00000   1.00000
/// <br>
/// U
/// <br>
/// 2.00000   4.00000   7.00000
/// 0.00000   1.00000   1.50000
/// 0.00000   0.00000  -2.00000
/// <br>
/// P
/// <br>
/// 0   1   0
/// 1   0   0
/// 0   0   1
/// </pre>
/// <br>
/// Example 2:
/// <pre>
/// A
/// <br>
/// 11    9   24    2
///  1    5    2    6
///  3   17   18    1
///  2    5    7    1
/// <br>
/// L
/// <br>
/// 1.00000   0.00000   0.00000   0.00000
/// 0.27273   1.00000   0.00000   0.00000
/// 0.09091   0.28750   1.00000   0.00000
/// 0.18182   0.23125   0.00360   1.00000
/// <br>
/// U
/// <br>
/// 11.00000    9.00000   24.00000    2.00000
///  0.00000   14.54545   11.45455    0.45455
///  0.00000    0.00000   -3.47500    5.68750
///  0.00000    0.00000    0.00000    0.51079
/// <br>
/// P
/// <br>
/// 1   0   0   0
/// 0   0   1   0
/// 0   1   0   0
/// 0   0   0   1
/// </pre>
/// <br>
/// <br>

/// challengeSeed:
function replaceMe (foo) {
  // Good luck!
  return true;
}

/// solutions:


/// rawSolutions:
null

/// tail:
const replaceThis = 3;

/// tests:
assert(typeof replaceMe === 'function', 'message: <code>replaceMe</code> is a function.');
